[TOC]

# LRé¡¹ä¸å±•æœ›é›†çš„æ„é€ 

åè¯çº¦å®š:

- å±•æœ›é›†,LRä¸­æ¯ä¸ªé¡¹éƒ½æœ‰è‡ªå·±çš„å±•æœ›ç¬¦é›†,ä¸€ä¸ªé¡¹çš„å±•æœ›ç¬¦é›†å†³å®šä½•æ—¶å¯ä»¥å½’çº¦(åç§°lookaheadSet,æœ‰æ—¶ç®€ç§°lookSet)
- å±•å¼€ç¬¦å·,ä¾‹å¦‚é¡¹S->Â·Eæ˜¯å¯å±•å¼€çš„,å±•å¼€ç¬¦å·ä¸ºE

## 1. ä¸€ä¸ªé¡¹ä½•æ—¶åº”è¯¥å±•å¼€

å¯¹äºä½•æ—¶åº”è¯¥å±•å¼€ éœ€è¦è€ƒè™‘å¦‚ä¸‹å‡ ç§æƒ…å†µ


- 1.1 æ²¡æœ‰åç»§ç¬¦å·ã€Œç‚¹ã€å·²ç»åˆ°äº†äº§ç”Ÿå¼çš„æœ€æœ«å°¾,å½¢å¦‚`A-> XÂ·`,ä¸å±•å¼€
- 1.2 æœ‰åç»§ç¬¦å·,ä½†å±•å¼€ç¬¦æ˜¯ç»ˆç»“ç¬¦,å½¢å¦‚ `A-> Â·a`,ä¸å±•å¼€
- 1.3 æœ‰åç»§ç¬¦å·,ä¸”ä¸ºéç»ˆç»“ç¬¦

å¯¹äºæƒ…å†µ 1.3,åˆå¯åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§æƒ…å†µ:

1. ç”±åˆ«çš„é¡¹å±•å¼€è‡ªå·±

	```
		S->A
		A->B | Bğœ¶
		B->b

		I0
		S->Â·A
		A->Â·B
		A->Â·Bğœ¶
		B->Â·b   $
		B->Â·b   ğœ¶
	```

	å¦‚ä¸ŠçŠ¶æ€é›†ä¸­,Bè¢«Açš„ä¸¤ä¸ªé¡¹åˆ†åˆ«å¼•ç”¨,å› æ­¤å±•å¼€å°†ä¸¤æ¬¡:
	- ç”±`A->Â·B` å¯å±•å¼€å¾—åˆ° `B->Â·b`,å±•æœ›é›†ä¸º`$`
	- ç”±`A->Â·Bğœ¶` å¯å±•å¼€å¾—åˆ° `B->Â·b`,å±•æœ›é›†ä¸º`ğœ¶`

	ç”±äºæ¯ä¸€æ¬¡å±•å¼€,å±•æœ›é›†éƒ½ä¸åŒ,æ­¤ç§æƒ…å†µå…è®¸åŒä¸€ç¬¦å·è¢«å¤šæ¬¡å±•å¼€âœ…(ä¸”è¿™ä¸¤ä¸ªé¡¹åº”è¯¥è¢«åˆå¹¶)

2. è‡ªå·±å±•å¼€è‡ªå·±

	ç¤ºä¾‹1,åœ¨é¡¹ A->Â·AAb ä¸­,ç”±äºä¸ºå·¦é€’å½’äº§ç”Ÿå¼,ä¸”ã€Œç‚¹ã€ä½äºã€Œå·¦é€’å½’ç¬¦å·ã€å‰,å¦‚æœå±•å¼€å°†é‡å¤äº§ç”Ÿç›¸åŒçš„é¡¹,å› æ­¤ä¸èƒ½å†å±•å¼€A.âŒ
	```
		S->A
		A->AAb | a

		I0
		S->Â·A
		A->Â·AAb
		A->Â·a
	```

	ç¤ºä¾‹2,åœ¨é¡¹A->AÂ·Abä¸­,è™½ç„¶å·¦é€’å½’,ä½†ã€Œç‚¹ã€åœ¨å·¦é€’å½’ç¬¦å·ä¹‹å,å› æ­¤å¯ä»¥å±•å¼€A. I1ç»§ç»­åŠ å…¥å¦‚ä¸‹é¡¹:âœ…
	```
		I1
		S->AÂ·
		A->AÂ·Ab
	```

	ç¤ºä¾‹3,æ­¤æ—¶,åœ¨é¡¹A->Â·AAbä¸­,ã€Œç‚¹ã€ä½äºå·¦é€’å½’ç¬¦å·ä¹‹å‰,å› æ­¤ä¸èƒ½å†å±•å¼€AâŒ

	```
		A->Â·AAb
		A->Â·a

	```

**ç»“è®º**

0. å­˜åœ¨å±•å¼€ç¬¦å·,ä¸”å±•å¼€ç¬¦å·ä¸ºéç»ˆç»“ç¬¦
1. ä¸€ä¸ªç¬¦å·è¢«ä¸åŒçš„å¤šä¸ªä¸ªé¡¹å¼•ç”¨,å¯ä»¥é‡å¤å±•å¼€å¤šæ¬¡
2. å·¦é€’å½’ ä¸” å±•å¼€ç¬¦ä¸ºæœ€å·¦ç¬¦å· ä¸å¾—å±•å¼€ , å½¢å¦‚ A->Â·AAğœ¶
3. å·¦é€’å½’ ä½† å±•å¼€ç¬¦ä¸æ˜¯æœ€å·¦ç¬¦å·,å¯ä»¥å±•å¼€,å½¢å¦‚ A->AÂ·Ağœ¶


## 2.å¦‚ä½•å±•å¼€(LRå±•æœ›ç¬¦é›†è®¡ç®—)

å¯¹å±•æœ›ç¬¦çš„è®¡ç®—å¯åˆ†ä¸º2ç§æƒ…å†µ

ä¾‹:

```
S->E
E->E+F | E*F | F
F->id | (E)
```

### 2.1. é’ˆå¯¹é—­åŒ…é¡¹

åˆå§‹çŠ¶æ€I0ä¸­çš„æ ¸å¿ƒé¡¹S->Â·Eäº§ç”Ÿå¦‚ä¸‹4ä¸ªé—­åŒ…é¡¹:

```
I0
S->Â·E       $
E->Â·E+F		?
E->Â·E*F		?
E->Â·F		?
F->Â·id		?
```

#### 2.1.1 å±•å¼€ç¬¦æ˜¯å·¦é€’å½’çš„

æ ¸å¿ƒé¡¹`S->Â·E `çš„å±•å¼€ç¬¦ä¸ºE,æŒ‰ç…§æœŸæœ›,Eåº”è¯¥å±•å¼€å¦‚ä¸‹3ä¸ªé¡¹:

```
E->Â·E+F		?
E->Â·E*F		?
E->Â·F		?
```

ç”±äºEæ˜¯å·¦é€’å½’çš„,åœ¨å±•å¼€Eæ—¶,éœ€è¦å¯¹å…¶å­äº§ç”Ÿå¼äº§ç”Ÿçš„é¡¹åšç‰¹æ®Šå¤„ç†.

 `E->Â·E+F`ã€`E->Â·E*F`ã€`E->Â·F` å‡ä¸ºå·¦é€’å½’äº§ç”Ÿå¼,å®ƒä»¬å¯èƒ½å¤„äºæœ«ç«¯,ä¹Ÿå¯èƒ½è¢«åµŒå…¥å¦ä¸€ä¸ªå·¦é€’å½’äº§ç”Ÿå¼

ä¾‹1 å¯¹äºé¡¹E->Â·E+Fè€Œè¨€

- å¦‚æœå®ƒå¤„äºæœ«ç«¯,é‚£ä¹ˆ lookSet(EÂ·E+F)å°±åº”è¯¥æœ‰`$` (ç»§æ‰¿è‡ª lookSet(S->Â·E))
- å¦‚æœå®ƒè¢«åµŒå…¥E->Â·E*F,é‚£ä¹ˆ lookSet(E->Â·E+F)å°±åº”è¯¥æœ‰`*`
- å¦‚æœå®ƒè¢«åµŒå…¥E->Â·E+F,é‚£ä¹ˆ lookSet(E->Â·E+F)å°±åº”è¯¥æœ‰`+`
- è¦æ³¨æ„,å®ƒä¸å¯èƒ½è¢«åµŒå…¥E->Â·F,æ‰€ä»¥ lookSet(E->Â·E+F)ä¸åŒ…å«`id`

ä¾‹2 å¯¹äºE->Â·Fè€Œè¨€,è™½ç„¶å…¶æœ¬èº«æ²¡æœ‰å·¦é€’å½’,ä½†æ˜¯ç”±äºå®ƒçš„å…„å¼Ÿé¡¹ä¸­å­˜åœ¨å·¦é€’å½’é¡¹,å› æ­¤å®ƒä»ç„¶å¯èƒ½è¢«åµŒå…¥å…¶å·¦é€’å½’çš„å…„å¼Ÿé¡¹
- å¦‚æœE->Â·F ç›´æ¥ä½œä¸ºS->Â·Eçš„å³ä¾§,é‚£ä¹ˆLookSet(E->Â·F)åº”åŒ…å«`$` (ç»§æ‰¿è‡ª lookSet(S->Â·E))
- å¦‚æœE->Â·Fè¢«åµŒå…¥E->Â·E+F,é‚£ä¹ˆLookSet(E->Â·F)åº”åŒ…å«`+`
- å¦‚æœE->Â·Fè¢«åµŒå…¥E->Â·E*F,é‚£ä¹ˆLookSet(E->Â·F)åº”åŒ…å«`*`

æ›´ä¸€èˆ¬çš„è®²,ä¸€ä¸ªå·¦é€’å½’é¡¹çš„LookSetåº”è¯¥åŒ…å«å®ƒçš„ã€Œå·¦é€’å½’å…„å¼Ÿé¡¹åŠå…¶æœ¬èº«ã€çš„ã€Œæœ€å·¦éå·¦é€’å½’ç¬¦å·ã€,ä»¥åŠç»§æ‰¿çš„LookSet
åœ¨æœ¬ä¾‹ä¸­,E->Â·E+Fçš„ã€Œå·¦é€’å½’å…„å¼Ÿé¡¹ã€æ˜¯ E->Â·E*F,è¿™ä¸ªå…„å¼Ÿé¡¹çš„ã€Œæœ€å·¦éå·¦é€’å½’ç¬¦å·ã€æ˜¯`*`, ä¸”ç»§æ‰¿äº†æ¥è‡ªäºS->Â·Eçš„lookSet`$`.

```
E->Â·E+F     $,+,*
E->Â·E*F     $,+,*
E->Â·F       $,+,*
```

### 2.1.2 å±•å¼€ç¬¦ä¸æ˜¯å·¦é€’å½’çš„

å¯åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§æƒ…å†µ:

- å±•å¼€ç¬¦ä½äºæœ«å°¾,é¡¹å½¢å¦‚A->ğœ¶Â·B,ç”±Bå±•å¼€çš„é¡¹åº”ç»§æ‰¿Açš„å±•æœ›é›†.

	`E->Â·F`,çš„å±•å¼€ç¬¦Fä½äºäº§ç”Ÿå¼æœ«å°¾,ç¬¦åˆç¬¬ä¸€ç§æƒ…å†µ,å› æ­¤Få±•å¼€çš„é¡¹åº”è¯¥ç»§æ‰¿E:

	```
	F->Â·id	$,+,*
	F->Â·(E)	$,+,*
	```

- å±•å¼€ç¬¦ä¸ä½äºæœ«å°¾,é¡¹å½¢å¦‚A->Â·Bğœ¶ğœ·
	- è‹¥ğ´âˆ‰First(ğœ¶) ç”±å±•å¼€ç¬¦Bå¾—åˆ°çš„é¡¹çš„lookSetä¸ºFirst(ğœ¶)
	- å¦åˆ™,åº”å½“ç»§ç»­åŠ å…¥First(B),é‡å¤ä»¥ä¸Šè¿‡ç¨‹,ç›´åˆ°æœ«å°¾æ—¶,å¦‚æœä»åŒ…å«ğ´,åˆ™åŠ å…¥lookSet(A)

	`First->(Â·E)`,çš„å±•å¼€ç¬¦åé¢ä»æœ‰ç¬¦å·,æ‰€ä»¥Eå±•å¼€çš„é¡¹çš„lookSetå°†åŒ…å«`)`

	```
	E->Â·E+F     ),+,*
	E->Â·E*F     ),+,*
	E->Â·F       ),+,*
	```
	> ç”±äºEæ˜¯å·¦é€’å½’çš„,å› æ­¤lookSetä¼šåŒ…å«`+,*`


### 2.2 é’ˆå¯¹å‰è¿›é¡¹

å¦‚æœåªæ˜¯å•çº¯çš„é¡¹çš„ã€Œç‚¹ã€å‰è¿›,é‚£ä¹ˆå¯ä»¥ç›´æ¥ç»§æ‰¿.
ä¾‹å¦‚,é¡¹E->Â·E+F å‰è¿›åå¾—åˆ°é¡¹E->EÂ·+F, åè€…çš„lookSetç»§æ‰¿å‰è€….

## 3. å±•å¼€åçš„å¤„ç†

3.1 å¦‚æœé¡¹é›†ä¸­å­˜åœ¨äº§ç”Ÿå¼ç›¸åŒ,ä¸”ã€Œç‚¹ã€çš„ä½ç½®ç›¸åŒçš„é¡¹, åº”å°†å®ƒä»¬åˆå¹¶.

ä¾‹
```
S->A
A->B | Bğœ¶
B->b
```

ä»¥ä¸Šæ–‡æ³•çš„åˆå§‹çŠ¶æ€:
```
S->Â·A
```

å±•å¼€A,å¾—åˆ°å¦‚ä¸‹ä¸¤ä¸ªé—­åŒ…é¡¹:

```
A->Â·B		$
A->Â·Bğœ¶	 	$
```

ç”±äºBä¼šè¢«å±•å¼€ä¸¤æ¬¡,å› æ­¤åˆ†åˆ«å¾—åˆ°å¦‚ä¸‹ä¸¤ä¸ªé¡¹:

```
B->Â·b   $
B->Â·b   ğœ¶
```

ç”±äºä¸¤è€…æ˜¯åŒå¿ƒé¡¹çš„(æ³¨æ„,æ­¤åŒå¿ƒæ˜¯æŒ‡é¡¹,å¹¶éLALRä¸­é’ˆå¯¹é¡¹é›†çš„åŒå¿ƒ),ä¸€ä¸ªçŠ¶æ€(é¡¹é›†)ä¸­å­˜åœ¨ä¸¤ä¸ªåŒå¿ƒé¡¹æ˜¯æ— æ„ä¹‰çš„,å› æ­¤åº”å½“å°†å…¶åˆå¹¶:

```
B->Â·b   $,ğœ¶
```

---

# çŠ¶æ€æœºçš„æ„é€ 

æ„é€ çŠ¶æ€æœºçš„è¿‡ç¨‹å°±æ˜¯æ„é€ æœ‰å‘å›¾çš„è¿‡ç¨‹.
ä¸€ä¸ªé¡¹é›†å¯¹åº”ä¸€ä¸ªçŠ¶æ€,æ¯ä¸ªçŠ¶æ€ç»´æŠ¤äº†ä¸åç»§çŠ¶æ€çš„è¾¹ ,å¯¹æ¯ä¸ªçŠ¶æ€è¾“å…¥æŸä¸€ä¸ªç¬¦å·å¯åˆ°è¾¾ä¸‹ä¸€ä¸ªçŠ¶æ€.

```
S->E
E->E+T | T
T->T*F | F
F->(E) | id
```

åœ¨åˆå§‹çŠ¶æ€,å†…æ ¸é¡¹ä¸º`S->Â·E`, å¯¹å…¶æ±‚é—­åŒ…,å¯å¾—åˆ°ç¬¬ä¸€ä¸ªçŠ¶æ€I0:

```
I0
S->Â·E
E->Â·E+T
E->Â·T
T->Â·T*F
T->Â·F
F->Â·(E)
F->Â·id
```

å¯çŸ¥,I0çš„åç»§ç¬¦å·é›†åˆä¸º: {E,T,F,(,id}, éå†è¯¥é›†åˆ,å¯å¾—åˆ°åç»§çŠ¶æ€,ä»¥åŠI0ä¸è¿™äº›åç»§çŠ¶æ€çš„è¾¹:

```
ğ›‚=E
    E->EÂ·+T
ğ›‚=T
    E->TÂ·
    T->TÂ·*F
ğ›‚=F
    T->FÂ·
ğ›‚=(
    F->(Â·E)
ğ›‚=id
    F->idÂ·
```

å¯¹æ–°äº§ç”Ÿçš„çŠ¶æ€æ±‚é—­åŒ…,å¯å¾—åˆ°:

```
I1
    E->EÂ·+T
I2
    E->TÂ·
    T->TÂ·*F
I3
    T->FÂ·
I4
    F->(Â·E)
    E->Â·E+T
    E->Â·T
    T->Â·T*F
    T->Â·F
    F->Â·(E)
    F->Â·id
I5
    F->idÂ·
```

é‡å¤ä¸Šé¢çš„è¿‡ç¨‹,ç›´åˆ°æ²¡æœ‰æ–°çš„çŠ¶æ€äº§ç”Ÿ.


# LRåˆ†æè¡¨

LRåˆ†æè¡¨æè¿°äº†ã€Œä»€ä¹ˆçŠ¶æ€ã€ å¯¹ ã€Œä»€ä¹ˆç¬¦å·ã€ åº”è¯¥æ‰§è¡Œã€Œä»€ä¹ˆæ“ä½œã€.

è®¡ç®—LRåˆ†æè¡¨çš„æœ¬è´¨å°±æ˜¯,ç¡®å®šå¦‚ä¸‹3ç‚¹:

- ä»€ä¹ˆçŠ¶æ€: ç¡®å®šåˆ†æè¡¨çš„è¡Œæ•°,çŠ¶æ€å¯é€šè¿‡è‡ªåŠ¨æœºè·å¾—.
- ä»€ä¹ˆç¬¦å·: ç¡®å®šäº†æ¯ä¸€è¡Œçš„åˆ—æ•°,å¯é€šè¿‡çŠ¶æ€ä¸­çš„é¡¹
- ä»€ä¹ˆæ“ä½œ: å¯ä¸º Shiftã€GOTOã€Reduceã€Accept ä¹‹ä¸€


**ä»€ä¹ˆçŠ¶æ€**,é€šè¿‡éå†è‡ªåŠ¨æœºå³å¯å¾—ç¡®å®šåˆ†æè¡¨çš„æ¯ä¸€è¡Œ.

**ä»€ä¹ˆç¬¦å·**,å³lookahead,è¯¥ç¬¦å·ç¡®å®šäº†æ¯ä¸€è¡Œçš„åˆ—æ•°
- å¯¹äºä¸€ä¸ªå½¢å¦‚A->ğœ¶Â·ğœ·çš„é¡¹,å…¶lookaheadä¸ºğœ·
- Reduce/Accept,å–å†³äºå…·ä½“åˆ†æç®—æ³•:
	- SLR,lookheadå­˜åœ¨äºã€Œé¡¹å¯¹åº”çš„äº§ç”Ÿå¼çš„Followé›†ã€
	- LR,lookheadå­˜åœ¨äºé¡¹çš„å±•æœ›é›†(lookaheadSet)

**ä»€ä¹ˆæ“ä½œ** (å…³äºShiftã€GOTOã€Reduceã€Acceptçš„äº§ç”Ÿæ—¶æœº)
- æ¯å½“é‡åˆ°å½¢å¦‚A->ğœ¶Â·ğœ·çš„é¡¹æ—¶,å¦‚æœğœ·æ˜¯éç»ˆç»“ç¬¦åˆ™äº§ç”ŸGOTOåŠ¨ä½œ,å¦åˆ™ä¸ºShift
- æ¯å½“é‡åˆ°å½¢å¦‚A->ğœ¶Â·çš„é¡¹æ—¶,å¦‚æœAæ˜¯å¼€å§‹ç¬¦å·åˆ™Accpet,å¦åˆ™ä¸ºReduce

ä¼ªä»£ç å¦‚ä¸‹:

```
for(è‡ªåŠ¨æœºä¸­çš„æ¯ä¸€ä¸ªçŠ¶æ€S){
	for(Sä¸­çš„æ¯ä¸€ä¸ªé¡¹I){
		if(Iå½¢å¦‚A->ğœ¶Â·ğœ·){
			å¦‚æœğœ·æ˜¯éç»ˆç»“ç¬¦åˆ™äº§ç”ŸGOTOåŠ¨ä½œ,å¦åˆ™ä¸ºShift
		}
		if(Iå½¢å¦‚A->ğœ¶Â·){
			å¦‚æœAæ˜¯å¼€å§‹ç¬¦å·åˆ™Accpet,å¦åˆ™ä¸ºReduce
		}
	}
}
```

## å…³äºå†²çªæ£€æŸ¥

### 1 ç§»å…¥-å½’çº¦å†²çª

1.1 å…è®¸å¤šä¸ªé¡¹ç§»å…¥åŒä¸€ç¬¦å·,è€ƒè™‘å¦‚ä¸‹ä¸¤ä¸ªé¡¹:

```
S->Â·E
E->Â·E+T
```
å®ƒä»¬çš„ nextSymbol éƒ½æ˜¯ E, åœ¨å¤„ç†ç¬¬ä¸€ä¸ªé¡¹æ—¶,å·²ç»è®¡ç®—äº†å½“å‰çŠ¶æ€å¯¹è¾“å…¥Eçš„åç»§çŠ¶æ€,æ‰€ä»¥åœ¨å½“å‰çŠ¶æ€ç¬¬äºŒæ¬¡é‡åˆ°Eæ—¶,ä¸å¿…å†é‡æ–°å¤„ç†.

1.2 å¯¹åŒä¸€lookahead,å­˜åœ¨ç§»å…¥ã€å½’çº¦æ“ä½œ,è€ƒè™‘å¦‚ä¸‹é¡¹é›†:

```
	E->E+EÂ·,{+,*,EOF}
	E->EÂ·+E,{+,*,EOF}
	E->EÂ·*E,{+,*,EOF}
```

è¯¥é¡¹é›†å¯¹äºè¾“å…¥{+,*,EOF},åŒæ—¶å­˜åœ¨ç§»å…¥ã€å½’çº¦æ“ä½œ.

### 2 å½’çº¦-å½’çº¦å†²çª

åŸåˆ™ä¸ŠåŒä¸€ä¸ªçŠ¶æ€å¯¹åŒä¸€ç¬¦å·åªèƒ½æœ‰ä¸€ä¸ªæ“ä½œ,è‹¥ä¸ªä¸€ä¸ªçŠ¶æ€ä¸­çš„å¤šä¸ªå½’çº¦é¡¹çš„Followé›†å­˜åœ¨äº¤é›†,é‚£ä¹ˆåˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§æƒ…å†µè¿›è¡Œå¤„ç†:

2.1 å…è®¸çŠ¶æ€ä¸­å¤šä¸ªé¡¹å½’çº¦ä¸ºåŒä¸€ä¸ªç¬¦å·. å¦‚ä¸‹ä¾‹å­ä¸­,è™½ç„¶ä¸¤ä¸ªé¡¹çš„Followé›†éƒ½ä¸ºFollow(A),ä½†æ˜¯å½’çº¦åŠ¨ä½œ/ç»“æœéƒ½æ˜¯ç›¸åŒçš„(éƒ½æ˜¯A),å› æ­¤å…è®¸è¯¥æƒ…å†µå­˜åœ¨.
```
	A->ğœ¶Â·
	A->ğœ¶Â·
```
2.2 ä¸å…è®¸çŠ¶æ€ä¸­å¤šä¸ªé¡¹å½’çº¦ä¸ºä¸åŒç¬¦å·. å¦‚ä¸‹ä¾‹å­ä¸­,Follow(A) âˆ© Follow(B)ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹,æ— æ³•é¢„çŸ¥å½’çº¦ä¸ºAè¿˜æ˜¯B,å› æ­¤å¦‚ä¸‹æƒ…å†µä¸å…è®¸å­˜åœ¨.
```
	A->ğœ¶Â·
	B->ğœ¶Â·
```

### 3 å…¶ä»–å†²çª

3.1 å…è®¸GOTO-GOTOå†²çª, å³: A->aÂ·C B->bÂ·C

3.2 Acceptå’Œ GOTOã€Shiftã€Reduceéƒ½ä¸å¯èƒ½å†²çª,å› ä¸ºAcceptå…·å¤‡ä»¥ä¸‹ç‰¹å¾:
- EOFæ‰å¯èƒ½è§¦å‘Accept (Shiftã€GOTOä¸å…·å¤‡)
- å½’çº¦é¡¹å¿…é¡»ä¸ºå¼€å§‹ç¬¦å· (Reduceä¸å…·å¤‡)


## å…³äºä¼˜å…ˆçº§ä¸ç»“åˆæ€§

æ¯ä¸€ä¸ªé¡¹éƒ½å…·æœ‰ä¼˜å…ˆçº§(prec)ã€ç»“åˆæ€§(assoc)å±æ€§.

```
E->E+EÂ·,{+,*,EOF}
E->EÂ·+E,{+,*,EOF}
E->EÂ·*E,{+,*,EOF}

+: prec=1,assoc=left
*: prec=2,assoc=left
```

### å¦‚ä½•ç¡®å®šä¼˜å…ˆçº§ã€ç»“åˆæ€§

**äº§ç”Ÿå¼çš„ä¼˜å…ˆçº§ä¸ç»“åˆæ€§**

ä¸€ä¸ªäº§ç”Ÿå¼çš„precã€assocç”±äº§ç”Ÿå¼ä¸­çš„ç¬¦å·(å¯ä»¥ä¸ºéç»ˆç»“ç¬¦)å†³å®š. ä¸Šä¾‹ä¸­,`E->E+E`çš„precã€assocç»§æ‰¿`+`,å³: `prec=1,assoc=left`.
å¦‚æœäº§ç”Ÿå¼ä¸­å­˜åœ¨å¤šä¸ªç¬¦å·å…·æœ‰precã€assoc,åˆ™ä»¥precæœ€å¤§çš„ç¬¦å·ä¸ºå‡†,ä¾‹å¦‚ `E->E+E*`ä¸­,`*`çš„ä¼˜å…ˆçº§é«˜äº`+`,å› æ­¤è¯¥äº§ç”Ÿå¼çš„precã€assocä»¥`*`ä¸ºå‡†,å³`*: prec=2,assoc=left`.

**é¡¹çš„ä¼˜å…ˆçº§**

é¡¹çš„ä¼˜å…ˆçº§ã€ç»“åˆæ€§ç»§æ‰¿äºå¯¹åº”çš„äº§ç”Ÿå¼.

**æ“ä½œçš„ä¼˜å…ˆçº§ä¸ç»“åˆæ€§**

æ“ä½œçš„precã€assocå–å†³äºäº§ç”Ÿè¯¥æ“ä½œçš„é¡¹. ä¾‹å¦‚: E->EÂ·+E,ä¼šäº§ç”Ÿå¼ä¸€ä¸ªå¯¹`+`çš„`shift`æ“ä½œ,è¯¥æ“ä½œçš„ä¼˜å…ˆçº§ã€ç»“åˆæ€§å–å†³äºé¡¹`E->EÂ·+E`;ç±»ä¼¼çš„,`E->E+EÂ·`ä¼šäº§ç”Ÿå¼ä¸€ä¸ª`reduce`æ“ä½œ,è¯¥æ“ä½œçš„precã€assocå–å†³äº`E->E+EÂ·`

### å¦‚ä½•æ ¹æ®ä¼˜å…ˆçº§ã€ç»“åˆæ€§å†³å®šè§£å†³å†²çª

é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªæ“ä½œçš„precã€assoc

**ç§»å…¥å½’çº¦å†²çª**

```
	å¦‚æœç›¸åŒä¼˜å…ˆçº§
		ç»“åˆæ–¹å‘ç›¸åŒ
			- åŒä¸ºå·¦ç»“åˆ,ä¼˜å…ˆå½’çº¦
			- åŒä¸ºå³ç»“åˆ,ä¼˜å…ˆç§»å…¥
		ç»“åˆæ–¹å‘ä¸åŒ
			- ä¼˜å…ˆè§„çº¦
	ä¸åŒä¼˜å…ˆçº§
		é€‰æ‹©é«˜ä¼˜å…ˆçº§çš„æ“ä½œ
```

ä¾‹1,E->EÂ·+Eå¯¹`+`äº§ç”Ÿä¸€ä¸ª`shift`,è€ŒE->E+EÂ·å¯¹`+`äº§ç”Ÿä¸€ä¸ª`reduce`,ä¸¤ä¸ªæ“ä½œçš„ä¼˜å…ˆçº§ç›¸åŒ,ä¸”ä¸ºå·¦ç»“åˆ,å› æ­¤é€‰æ‹©`reduce`

ä¾‹2,E->EÂ·*Eå¯¹`*`äº§ç”Ÿä¸€ä¸ª`shift`, è€ŒE->E+EÂ·å¯¹`*`äº§ç”Ÿä¸€ä¸ª`reduce`,å‰è€…çš„ä¼˜å…ˆçº§æ›´é«˜,å› æ­¤é€‰æ‹©`shift`

**å½’çº¦å½’çº¦å†²çª**

```
	ä¼˜å…ˆçº§ç›¸åŒ,æŠ›å‡ºå¼‚å¸¸
	ä¼˜å…ˆçº§ä¸åŒ,æ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„æ“ä½œ
```

ä¾‹3,ä¸‹ä¾‹ä¸­,ä¸¤ä¸ªè§„çº¦é¡¹çš„ä¼˜å…ˆçº§åŒ,æ— æ³•å¾—çŸ¥åº”è¯¥è§„çº¦ä¸ºAã€è¿˜æ˜¯B,å°†æŠ›å‡ºå¼‚å¸¸.

```
S->A | B
A->a+b
B->a+b

+ left 1

A->a+bÂ·	$
B->a+bÂ·	$
```

# LR Parser

## è§„çº¦æ—¶å­èŠ‚ç‚¹é¡ºåºé—®é¢˜

è€ƒè™‘å¦‚ä¸‹æ–‡æ³•

```
S->E
E->E+T | E-T | T
T->T*F | T/F |F
F->(E) | NUM
```

å‡è®¾è¾“å…¥: `1 + 2 / 3`

å¿…ç„¶åœ¨æŸä¸€æ—¶åˆ» Ast Stackä¸­çš„å…ƒç´ ä¸º: `ENode + TNode / FNode`

æ­¤æ—¶,å³å°†è¦æ‰§è¡Œçš„åŠ¨ä½œæ˜¯å°† `TNode / FNode` å½’çº¦ä¸ºT,åˆ›å»ºä¸€ä¸ªTNode: `new TNode([TNode,'/',FNode])`

è¿™æ—¶è¦æ³¨æ„çš„æ˜¯,ä¼ ç»™TNodeçš„é›†åˆåº”è¯¥ä¿æŒä¸äº§ç”Ÿå¼ä¸­å®šä¹‰çš„ç¬¦å·é¡ºåºä¿æŒä¸€è‡´.

å‡å¦‚ä¼ å…¥çš„æ˜¯ [FNode,'/',TNode], é‚£ä¹ˆåŸæœ¬çš„2/3çš„å«ä¹‰å°†å˜ä¸º3/2

## Parser å®ç°

```
	parse(lexer: ILexer): ASTree {
		let startState = this.stateAutomata.satrtState();

		å£°æ˜ stateStack ,ä»¤çŠ¶æ€æ ˆçš„æ ˆé¡¶ä¸º0(åˆå§‹çŠ¶æ€)
		å£°æ˜ astStack

		ä»¤lookaheadä¸ºè¾“å…¥æµçš„ç¬¬ä¸€ä¸ªç¬¦å·

		while (1) {
			topS = stateStack.peek()
			action = parsingTable[topSta][lookahead]; //æŸ¥æ‰¾åˆ†æè¡¨,å¾—åˆ° topS å¯¹ lookahead çš„åŠ¨ä½œ action
			if (action is Shift) {
				astStack.push(lexer.next()); //lookaheadæ”¾å…¥ç¬¦å·æ ˆ
				stateStack.push(op.nextState); //çŠ¶æ€è£…å…¥åç»§çŠ¶æ€
				lookahead = lexer.peek(); //ä»¤lookaheadä¸ºä¸‹ä¸€ä¸ªç¬¦å·
			}
			else if (action is Goto) {
				stateStack.push(op.nextState);
				lookahead = lexer.peek();
			}
			else if (op is Reduce) {

				let eles: ASTElement[] = [];  /* æ­¤æ¬¡å½’çº¦äº§ç”Ÿçš„ASTèŠ‚ç‚¹æ‰€éœ€çš„å…ƒç´  */
				for (è§„çº¦äº§ç”Ÿå¼ä¸­çš„æ¯ä¸€ä¸ªç¬¦å·x) {
					ä»stateStackå¼¹å‡ºxå¯¹åº”çš„çŠ¶æ€ // æ¯ä¸ªçŠ¶æ€éƒ½ç”±è¾“å…¥ä¸€ä¸ªç¬¦å·å¾—åˆ° å› æ­¤æ¯ä¸ªçŠ¶æ€éƒ½ä¸€ä¸ªå¯¹åº”çš„ç¬¦å·  è¯¦è§:P158
				}
				astStack.push(op.prod.postAction(eles, astStack));  //issue ASTNodeçš„å…ƒç´ çš„é¡ºåºé—®é¢˜
				debug(`reduce ${op.prod}, make ast: ${astStack.peek()}`);
				//å°†å‘å‰çœ‹ç¬¦å·æŒ‡å®šä¸ºå½’çº¦ç¬¦å·
				lookahead = op.prod.head;
			}
			else if (action is Accept {
				debug(`accept!`);
				break;
			}
			debug(`${astStack.join(" ")}`);
		}
		return astStack.pop() as ASTree;
	}
```

